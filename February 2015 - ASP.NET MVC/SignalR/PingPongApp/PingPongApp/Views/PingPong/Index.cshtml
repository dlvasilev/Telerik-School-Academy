@section styles {

    <style type="text/css">
        canvas {
            border: 1px solid black;
            background-color: cyan;
        }
    </style>
}

@{
    ViewBag.Title = "Ping Pong Game";
}

<h2>@ViewBag.Title</h2>
<div id="pick-room-container">
    <div id="group-err-msg">Group not available!</div>
    <label for="room-name">Room</label>
    <input id="room-name" type="text" name="room-name" placeholder="Pick a room" />
    <button id="pick-btn" class="btn btn-default btn-md">Pick</button>
</div>

<canvas id="game-canvas" width="600" height="400"></canvas>
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    @Scripts.Render("~/bundles/signalR")
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script src="~/Scripts/pingPongGame.js"></script>

    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {

            var roomName;

            $('#game-canvas').hide();
            $('#group-err-msg').hide();
            // Reference the auto-generated proxy for the hub.
            var pingPong = $.connection.pingPongHub;

            // Create a function that the hub can call back to update opponent's direction.
            pingPong.client.updateClientStats = function (a, b, c, d, e) {

                console.log(a);
            };

            pingPong.client.groupNotAvailable = function () {

                $('#game-canvas').show();
                $('#group-err-msg').show();
            };

            pingPong.client.joinedGroup = function () {

                $('#pick-room-container').hide();
                $('#game-canvas').show();

                pingPongGame.setRoomName(roomName);
                pingPongGame.drawWaiting();
            };

            pingPong.client.startGame = function () {

                pingPongGame.startIfStopped(pingPong.server.updateGameStats);
            };

            $.connection.hub.start().done(function () {
                $('#pick-btn').click(function () {
                    // Call the Send method on the hub.
                    roomName = $('#room-name').val();

                    pingPong.server.join(roomName);
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}
